<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>タイピングバトル</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
    <style>
      /* Difficulty buttons style to match modes */
      .difficulty .seg { background: transparent; color: #0f172a; padding: 10px 14px; border-radius: 0; border: 0; font-weight: 700; }
      .difficulty .seg:hover { background: #e5e7eb; }
      .difficulty .seg.on { background: #ffffff; color: #0f172a; box-shadow: inset 0 -2px 0 0 var(--accent); }

      /* HP bars above side frames */
      .side-frame { position: fixed; }
      .side-frame .hp-float { position: absolute; left: 50%; top: 0; transform: translate(-50%, -110%); width: 88%; background: rgba(255,255,255,0.9); border: 1px solid #e5e7eb; border-radius: 10px; padding: 6px 8px; box-shadow: 0 6px 16px rgba(2,6,23,0.12); }
      .side-frame .hp-float .hp-label { display: flex; justify-content: space-between; font-size: 12px; color: #334155; margin-top: 4px; font-weight: 800; }
      .side-frame .hp-float .hp-bar { width: 100%; height: 10px; background: #e5e7eb; border-radius: 999px; overflow: hidden; }
      .side-frame .hp-float .hp-bar > div { height: 100%; width: 100%; transform-origin: left; transition: transform .18s ease; }
      .side-frame .hp-float.player .hp-bar > div { background: linear-gradient(90deg, #22c55e, #38bdf8); }
      .side-frame .hp-float.enemy  .hp-bar > div { background: linear-gradient(90deg, #ef4444, #f59e0b); }
    </style>
  </head>
  <body>
    <div class="app">
      <header class="header">
        <h1>タイピングバトル</h1>
        <div class="mode"><span id="modeLabel">60秒チャレンジ</span></div>
      </header>

      <section class="status">
        <div class="timer">
          <div class="time-text"><span id="timeLeft">60.0</span> 秒</div>
          <div class="timebar"><div id="timeBarFill"></div></div>
        </div>
        <div class="stats">
          <div>せいかい: <span id="score">0</span></div>
          <div>ミス: <span id="misses">0</span></div>
          <div>せいかくど: <span id="accuracy">100%</span></div>
          <div>レベル: <span id="level">1</span></div>
        </div>
      </section>

      <main class="game">
        <div class="prompt">
          <div id="kana" class="kana"></div>
          <div id="romaji" class="romaji"></div>
        </div>

        <div class="input">
          <input id="typeInput" type="text" inputmode="latin" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="ローマ字で入力してね" disabled />
          <div id="hint" class="hint">スタートをおして はじめよう</div>
        </div>

        <div class="character-slot" aria-label="キャラクター">
          <img
            id="character"
            alt="キャラクター"
            src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' viewBox='0 0 240 240'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='%23a5b4fc'/><stop offset='1' stop-color='%2381e6d9'/></linearGradient></defs><circle cx='120' cy='120' r='96' fill='url(%23g)'/><circle cx='92' cy='105' r='10' fill='%230f172a'/><circle cx='148' cy='105' r='10' fill='%230f172a'/><path d='M85 148 Q120 172 155 148' fill='none' stroke='%230f172a' stroke-width='8' stroke-linecap='round'/></svg>"
            data-idle=""
          />
        </div>
      </main>

      <section class="controls">
        <div class="modes" role="group" aria-label="制限時間（秒）をえらぶ" title="制限時間（秒）">
          <span class="modes-label">制限時間（秒）</span>
          <button class="seg" data-seconds="unlimited">無制限</button>
          <button class="seg on" data-seconds="60">60秒</button>
          <button class="seg" data-seconds="100">100秒</button>
          <div class="custom">
            <input id="customSeconds" type="number" min="1" max="9999" step="1" placeholder="任意の秒数" aria-label="任意の秒数" />
            <button id="setCustomBtn" class="seg set">設定</button>
          </div>
        </div>
        <button id="startBtn" class="primary">スタート</button>
        <button id="restartBtn" class="secondary" disabled>リスタート</button>
      </section>

      <section class="controls" aria-label="難易度">
        <div class="difficulty" role="group" aria-label="難易度">
          <span class="modes-label">難易度</span>
          <button class="seg" data-difficulty="easy">簡単</button>
          <button class="seg on" data-difficulty="normal">普通</button>
          <button class="seg" data-difficulty="hard">難しい</button>
        </div>
      </section>

      <!-- BGM controls removed -->

      <section class="controls" aria-label="ローマ字方式">
        <div class="roman-controls" role="group" aria-label="ローマ字方式">
          <span>入力方式:</span>
          <label style="margin-left:8px;"><input type="radio" name="romanization" id="romanHepburn" value="hepburn" checked> ヘボン式</label>
          <label style="margin-left:8px;"><input type="radio" name="romanization" id="romanKunrei" value="kunrei"> 訓令式</label>
        </div>
      </section>

      <footer class="footer">
        <p>かなをよんで、ローマ字でタイプしよう。例: 「いぬ」→ inu</p>
      </footer>
    </div>

    <div id="results" class="results hidden" role="dialog" aria-modal="true">
      <div class="results-card">
        <h2>けっか</h2>
        <img id="gameOverImg" class="gameover-image" alt="ゲームオーバー画像" data-src="assets/characters/assetscharactersgameover.png.png" />
        <ul class="result-list">
          <li>せいかい こうもく: <strong id="resScore">0</strong></li>
          <li>せいかくど: <strong id="resAccuracy">0%</strong></li>
          <li>WPM (めやす): <strong id="resWpm">0</strong></li>
        </ul>
        <div class="results-actions">
          <button id="closeResults" class="primary">もういちど</button>
        </div>
      </div>
    </div>

    <div id="levelUp" class="levelup hidden" aria-live="polite">
      <div class="levelup-card">
        <div class="levelup-title">レベルアップ！</div>
        <img id="levelUpImg" class="levelup-image" alt="レベルアップ画像" />
        <div class="levelup-level">Lv <span id="levelUpNumber">1</span></div>
      </div>
      <div class="confetti-wrap" aria-hidden="true"></div>
    </div>

    <div id="gameOverOverlay" class="gameover hidden" aria-live="polite">
      <div class="gameover-card">
        <div class="gameover-title">GAME OVER</div>
        <img id="gameOverBigImg" class="gameover-big-image" alt="ゲームオーバー画像" data-src="assets/characters/assetscharactersgameover.png.png" />
        <div class="gameover-actions">
          <button id="goRestartBtn" class="primary">もういちど</button>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
  </html>
